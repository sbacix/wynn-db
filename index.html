<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wynncraft Ingredient DB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg-dark: #0f1115;
            --bg-card: #1a1d24;
            --border-color: #2a2e37;
            --accent: #4ade80;
            --text-main: #f3f4f6;
            --text-muted: #9ca3af;
        }
        body { background-color: var(--bg-dark); color: var(--text-main); font-family: ui-sans-serif, system-ui; }
        .tier-Mythic { color: #aa00aa; }
        .tier-Fabled { color: #ff5555; }
        .tier-Legendary { color: #55ffff; }
        .tier-Rare { color: #ff55ff; }
        .tier-Unique { color: #ffff55; }
        .tier-Normal { color: #ffffff; }
        .card-hover:hover { border-color: #4ade80; transform: translateY(-2px); }
        .custom-checkbox { accent-color: var(--accent); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="border-b border-[var(--border-color)] bg-[var(--bg-card)] sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="app.showList()">
                <i class="ph-fill ph-flask text-2xl text-[var(--accent)]"></i>
                <span class="font-bold text-xl uppercase tracking-tighter">Wynn<span class="text-[var(--accent)]">Ingredients</span></span>
            </div>
            <div class="text-xs font-mono text-[var(--text-muted)]" id="db-stats">Loading Data...</div>
        </div>
    </nav>

    <main class="flex-grow max-w-7xl mx-auto w-full px-4 py-8">
        <!-- List View -->
        <div id="view-list" class="flex flex-col md:flex-row gap-8">
            <aside class="w-full md:w-72 space-y-6">
                <div>
                    <label class="text-[10px] font-black uppercase tracking-widest text-gray-500 mb-2 block">Search</label>
                    <input type="text" id="filter-search" placeholder="Ingredient name..." class="w-full bg-[var(--bg-card)] border border-[var(--border-color)] rounded-lg p-3 text-sm focus:border-[var(--accent)] outline-none">
                </div>

                <div>
                    <label class="text-[10px] font-black uppercase tracking-widest text-gray-500 mb-2 block">Identifications</label>
                    <div class="bg-[var(--bg-card)] border border-[var(--border-color)] rounded-lg p-3">
                        <input type="text" id="stat-search" placeholder="Filter stats..." class="w-full bg-black/20 border-b border-[var(--border-color)] mb-3 pb-1 text-xs outline-none">
                        <div id="filter-identifications" class="max-h-60 overflow-y-auto space-y-2 text-sm"></div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] font-black uppercase tracking-widest text-gray-500 mb-2 block">Tier</label>
                        <select id="filter-tier" class="w-full bg-[var(--bg-card)] border border-[var(--border-color)] rounded-lg p-2 text-xs">
                            <option value="">All</option>
                            <option value="Normal">Normal</option><option value="Unique">Unique</option><option value="Rare">Rare</option>
                            <option value="Legendary">Legendary</option><option value="Fabled">Fabled</option><option value="Mythic">Mythic</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-black uppercase tracking-widest text-gray-500 mb-2 block">Level</label>
                        <input type="number" id="filter-lvl-min" placeholder="Min" class="w-full bg-[var(--bg-card)] border border-[var(--border-color)] rounded-lg p-2 text-xs">
                    </div>
                </div>
            </aside>

            <div class="flex-grow">
                <div id="results-count" class="text-sm font-bold text-gray-500 mb-6 uppercase tracking-widest"></div>
                <div id="ingredient-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>
        </div>

        <!-- Detail View -->
        <div id="view-detail" class="hidden animate-in fade-in duration-300">
            <button onclick="app.showList()" class="mb-8 flex items-center gap-2 text-sm font-bold text-gray-500 hover:text-white transition-colors">
                <i class="ph ph-caret-left"></i> BACK TO DATABASE
            </button>
            <div id="detail-container"></div>
        </div>
    </main>

    <div id="toast" class="fixed bottom-8 right-8 bg-white text-black px-6 py-3 rounded-full font-bold shadow-2xl opacity-0 transition-opacity pointer-events-none">Copied!</div>

    <script>
        const app = {
            data: [],
            init: async function() {
                try {
                    const res = await fetch('public/data/ingredients.json');
                    this.data = await res.json();
                    document.getElementById('db-stats').innerText = `${this.data.length} INGREDIENTS LOADED`;
                    this.buildFilters();
                    this.setupListeners();
                    this.applyFilters();
                } catch(e) { document.getElementById('results-count').innerText = "Data file not found. Run the GitHub Action!"; }
            },
            buildFilters: function() {
                const stats = new Set();
                this.data.forEach(i => i.identifications && Object.keys(i.identifications).forEach(s => stats.add(s)));
                document.getElementById('filter-identifications').innerHTML = Array.from(stats).sort().map(s => `
                    <label class="flex items-center gap-2 cursor-pointer hover:text-[var(--accent)] stat-row">
                        <input type="checkbox" value="${s}" class="stat-filter custom-checkbox">
                        <span class="truncate stat-name">${s.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</span>
                    </label>
                `).join('');
            },
            setupListeners: function() {
                ['filter-search', 'filter-tier', 'filter-lvl-min', 'filter-identifications'].forEach(id => {
                    document.getElementById(id).addEventListener('input', () => this.applyFilters());
                });
                document.getElementById('stat-search').addEventListener('input', (e) => {
                    const val = e.target.value.toLowerCase();
                    document.querySelectorAll('.stat-row').forEach(r => r.style.display = r.innerText.toLowerCase().includes(val) ? 'flex' : 'none');
                });
            },
            applyFilters: function() {
                const search = document.getElementById('filter-search').value.toLowerCase();
                const tier = document.getElementById('filter-tier').value;
                const lvl = parseInt(document.getElementById('filter-lvl-min').value) || 0;
                const checked = Array.from(document.querySelectorAll('.stat-filter:checked')).map(c => c.value);

                const filtered = this.data.filter(i => {
                    if(search && !i.name.toLowerCase().includes(search)) return false;
                    if(tier && i.tier !== tier) return false;
                    if(lvl && (i.requirements?.level || 0) < lvl) return false;
                    if(checked.length > 0 && (!i.identifications || !checked.every(s => i.identifications[s]))) return false;
                    return true;
                });

                document.getElementById('results-count').innerText = `${filtered.length} Results`;
                document.getElementById('ingredient-grid').innerHTML = filtered.slice(0, 60).map(i => `
                    <div class="bg-[var(--bg-card)] border border-[var(--border-color)] rounded-xl p-5 cursor-pointer card-hover transition-all" onclick="app.showDetail('${i.internalName}')">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-bold text-lg tier-${i.tier}">${i.name}</h3>
                            <span class="text-[10px] font-bold text-gray-600 bg-black/30 px-2 py-1 rounded">LVL ${i.requirements?.level || 0}</span>
                        </div>
                        <div class="text-[10px] text-gray-500 uppercase font-black tracking-widest truncate">
                            ${i.dropMeta ? `Source: ${i.dropMeta.name}` : 'Source Unknown'}
                        </div>
                    </div>
                `).join('');
            },
            showDetail: function(name) {
                const i = this.data.find(x => x.internalName === name);
                document.getElementById('view-list').classList.add('hidden');
                document.getElementById('view-detail').classList.remove('hidden');
                
                let idHtml = Object.entries(i.identifications || {}).map(([k, v]) => `
                    <div class="flex justify-between py-1 border-b border-white/5">
                        <span class="text-sm text-gray-400 capitalize">${k.replace(/([A-Z])/g, ' $1')}</span>
                        <span class="font-mono text-sm ${v.maximum < 0 ? 'text-red-400' : 'text-green-400'}">${v.minimum || v} to ${v.maximum || v}</span>
                    </div>
                `).join('');

                // WYNNTILS STYLE SOURCE BOX
                let sourceBox = `
                    <div class="bg-black/40 rounded-xl p-6 border border-white/5">
                        <h4 class="text-xs font-black text-gray-500 uppercase tracking-[0.2em] mb-4">Obtain Information</h4>
                        ${i.dropMeta ? `
                            <div class="space-y-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500">
                                        <i class="ph-fill ph-skull text-xl"></i>
                                    </div>
                                    <div>
                                        <div class="text-[10px] font-bold text-gray-500 uppercase">Specific Mob Drop</div>
                                        <div class="text-lg font-bold text-white">${i.dropMeta.name}</div>
                                    </div>
                                </div>
                                <div class="bg-white/5 rounded-lg p-4 flex items-center justify-between">
                                    <div class="font-mono text-[var(--accent)] text-sm italic">${i.dropMeta.coordinates.join(', ')}</div>
                                    <button onclick="app.copy('/tp ${i.dropMeta.coordinates.join(' ')}')" class="bg-[var(--accent)] text-black font-black text-[10px] px-4 py-2 rounded uppercase tracking-widest hover:brightness-110 transition-all">Copy /TP</button>
                                </div>
                                ${i.nearestPlace ? `<div class="text-[10px] text-gray-500 italic"><i class="ph ph-map-pin"></i> Located near ${i.nearestPlace.name}</div>` : ''}
                            </div>
                        ` : `<div class="text-gray-500 italic text-sm">No official drop source listed. Likely a gathering material or global loot drop.</div>`}
                    </div>
                `;

                document.getElementById('detail-container').innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                        <div>
                            <h1 class="text-5xl font-black mb-2 tier-${i.tier}">${i.name}</h1>
                            <div class="flex gap-4 mb-8 text-xs font-bold uppercase tracking-widest text-gray-500">
                                <span>${i.tier} Tier</span>
                                <span>â€¢</span>
                                <span>Level ${i.requirements?.level || 0}</span>
                            </div>
                            <div class="space-y-1">${idHtml || '<div class="text-gray-600 italic">No Identifications</div>'}</div>
                        </div>
                        <div class="space-y-8">
                            ${sourceBox}
                            <div class="bg-white/5 rounded-xl p-6">
                                <h4 class="text-[10px] font-black text-gray-500 uppercase mb-3">Required For</h4>
                                <div class="flex flex-wrap gap-2">
                                    ${(i.requirements?.skills || []).map(s => `<span class="bg-white/10 px-3 py-1 rounded text-[10px] font-bold">${s}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },
            showList: function() {
                document.getElementById('view-detail').classList.add('hidden');
                document.getElementById('view-list').classList.remove('hidden');
            },
            copy: function(txt) {
                const el = document.createElement('textarea'); el.value = txt; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
                const t = document.getElementById('toast'); t.classList.remove('opacity-0'); setTimeout(() => t.classList.add('opacity-0'), 2000);
            }
        };
        app.init();
    </script>
</body>
</html>
