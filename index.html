<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imperial Sweat-Shop | Gated Knowledge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        :root {
            --bg-deep: #05070a;
            --surface: #0f1218;
            --border: #1e2530;
            --accent: #3b82f6;
            --gold: #d4af37;
        }

        body { 
            background-color: var(--bg-deep); 
            color: #e2e8f0; 
            font-family: 'Space Grotesk', sans-serif;
            margin: 0;
            overflow-x: hidden;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Solid Containers */
        .matte-container { background-color: var(--surface); border: 1px solid var(--border); }
        .matte-card { background-color: var(--surface); border: 1px solid var(--border); transition: all 0.15s ease-out; }
        .matte-card:hover { border-color: var(--accent); }

        /* Custom Inputs */
        .matte-input { 
            background-color: #05070a; 
            border: 1px solid var(--border); 
            color: white; 
            outline: none;
            transition: border-color 0.2s;
        }
        .matte-input:focus { border-color: var(--accent); }

        /* Level Slider Styling */
        .range-slider-container { position: relative; height: 4px; background: #1e2530; border-radius: 2px; margin: 15px 0; }
        .range-slider-progress { position: absolute; height: 100%; background: var(--accent); border-radius: 2px; }
        .range-input { position: absolute; width: 100%; top: -7px; background: none; pointer-events: none; -webkit-appearance: none; }
        .range-input::-webkit-slider-thumb { 
            height: 16px; width: 16px; border-radius: 4px; background: var(--accent); 
            cursor: pointer; pointer-events: auto; -webkit-appearance: none; border: 2px solid var(--bg-deep); 
        }

        /* Tier Left Borders */
        .tier-Mythic { border-left: 4px solid #a855f7 !important; }
        .tier-Fabled { border-left: 4px solid #ef4444 !important; }
        .tier-Legendary { border-left: 4px solid #3b82f6 !important; }
        .tier-Rare { border-left: 4px solid #ec4899 !important; }
        .tier-Unique { border-left: 4px solid #eab308 !important; }
        .tier-Normal { border-left: 4px solid #94a3b8 !important; }

        /* Text colors for names */
        .text-Mythic { color: #d8b4fe; }
        .text-Fabled { color: #fca5a5; }
        .text-Legendary { color: #93c5fd; }
        .text-Rare { color: #f9a8d4; }
        .text-Unique { color: #fde047; }

        .sweat-badge { background: #991b1b; color: white; font-size: 8px; padding: 2px 6px; font-weight: 800; letter-spacing: 0.1em; }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

        .btn-imperial {
            background-color: var(--accent);
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 10px;
            letter-spacing: 0.1em;
            transition: filter 0.2s;
        }
        .btn-imperial:hover { filter: brightness(1.2); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- NAVIGATION -->
    <nav class="sticky top-0 z-50 bg-[#0f1218] border-b border-[#1e2530] px-6 py-4">
        <div class="max-w-[1600px] mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4 cursor-pointer" onclick="app.showList()">
                <div class="w-10 h-10 bg-blue-600 flex items-center justify-center rounded-lg">
                    <i class="fas fa-shield-halved text-white"></i>
                </div>
                <div>
                    <div class="flex items-center gap-2">
                        <h1 class="text-xl font-bold tracking-tight leading-none text-white uppercase">Imperial Sweat-Shop</h1>
                        <span class="sweat-badge">GATED KNOWLEDGE</span>
                    </div>
                    <p class="text-[9px] text-slate-500 font-bold uppercase mt-1 tracking-[0.2em] mono">INTEL PROTOCOL v2.2</p>
                </div>
            </div>
            <div id="db-stats" class="hidden md:block mono text-[10px] text-blue-500 font-bold uppercase tracking-widest">
                Connecting to archives...
            </div>
        </div>
    </nav>

    <main class="flex-1 p-6 lg:p-10 max-w-[1600px] mx-auto w-full">
        
        <!-- LIST VIEW -->
        <div id="view-list" class="flex flex-col lg:flex-row gap-10">
            <!-- SIDEBAR FILTERS -->
            <aside class="w-full lg:w-72 space-y-8 flex-shrink-0">
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 block">Search Registry</label>
                        <input type="text" id="filter-search" placeholder="..." class="matte-input w-full p-3 rounded-lg text-sm">
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest block">Lvl Range</label>
                            <span class="mono text-[10px] text-blue-400 font-bold" id="lvl-display">1 - 130</span>
                        </div>
                        <div class="range-slider-container">
                            <div id="range-progress" class="range-slider-progress"></div>
                            <input type="range" id="lvl-min" min="1" max="130" value="1" class="range-input">
                            <input type="range" id="lvl-max" min="1" max="130" value="130" class="range-input">
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 block">Gated Properties</label>
                        <div class="matte-container rounded-xl p-3">
                            <input type="text" id="stat-search" placeholder="Filter traits..." class="w-full bg-transparent border-b border-[#1e2530] mb-3 pb-1 text-[10px] outline-none text-blue-400 font-bold">
                            <div id="filter-identifications" class="max-h-64 overflow-y-auto space-y-1 pr-2">
                                <!-- Filter traits injected here -->
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 block">Rarity Grade</label>
                        <select id="filter-tier" class="matte-input w-full p-3 rounded-lg text-xs font-bold cursor-pointer appearance-none">
                            <option value="">All Tiers</option>
                            <option value="Normal">Normal</option>
                            <option value="Unique">Unique</option>
                            <option value="Rare">Rare</option>
                            <option value="Legendary">Legendary</option>
                            <option value="Fabled">Fabled</option>
                            <option value="Mythic">Mythic</option>
                        </select>
                    </div>
                </div>
            </aside>

            <!-- GRID AREA -->
            <div class="flex-1">
                <div id="results-text" class="text-[10px] font-bold text-slate-600 uppercase tracking-[0.4em] mb-8 pb-2 border-b border-[#1e2530]">
                    Awaiting commands...
                </div>
                <div id="ingredient-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                    <!-- Cards injected here -->
                </div>
            </div>
        </div>

        <!-- DETAIL VIEW -->
        <div id="view-detail" class="hidden max-w-5xl mx-auto">
            <button onclick="app.showList()" class="mb-10 text-[10px] font-bold tracking-[0.3em] text-slate-500 hover:text-white transition-all uppercase flex items-center gap-2">
                <i class="fas fa-arrow-left"></i> Return to Archive
            </button>
            <div id="detail-container">
                <!-- Detail content injected here -->
            </div>
        </div>
    </main>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed bottom-10 right-10 bg-blue-600 text-white px-8 py-4 font-bold text-xs uppercase tracking-widest rounded-lg shadow-2xl opacity-0 transition-all pointer-events-none z-[100]">
        Coordinates Copied
    </div>

    <script>
        const app = {
            data: [],
            init: async function() {
                try {
                    // Adjust path if needed for your environment
                    const res = await fetch('public/data/ingredients.json');
                    this.data = await res.json();
                    document.getElementById('db-stats').innerText = `${this.data.length.toLocaleString()} ASSETS LOGGED`;
                    this.buildFilters();
                    this.setupListeners();
                    this.applyFilters();
                } catch(e) { 
                    document.getElementById('results-text').innerText = "ARCHIVE SYNC ERROR"; 
                    console.error(e);
                }
            },

            buildFilters: function() {
                const stats = new Set();
                this.data.forEach(i => i.identifications && Object.keys(i.identifications).forEach(s => stats.add(s)));
                document.getElementById('filter-identifications').innerHTML = Array.from(stats).sort().map(s => `
                    <label class="flex items-center gap-2 cursor-pointer hover:bg-white/5 p-1 rounded transition-colors group">
                        <input type="checkbox" value="${s}" class="stat-filter accent-blue-500">
                        <span class="truncate text-slate-500 text-[10px] font-bold uppercase group-hover:text-slate-300 transition-colors">${s.replace(/([A-Z])/g, ' $1')}</span>
                    </label>
                `).join('');
            },

            setupListeners: function() {
                const trigger = () => { this.updateSliderUI(); this.applyFilters(); };
                ['filter-search', 'filter-tier', 'lvl-min', 'lvl-max'].forEach(id => {
                    document.getElementById(id).addEventListener('input', trigger);
                });
                
                document.getElementById('filter-identifications').addEventListener('change', trigger);

                document.getElementById('stat-search').addEventListener('input', (e) => {
                    const val = e.target.value.toLowerCase();
                    document.querySelectorAll('.stat-filter').forEach(r => {
                        const label = r.closest('label');
                        label.style.display = label.innerText.toLowerCase().includes(val) ? 'flex' : 'none';
                    });
                });
                this.updateSliderUI();
            },

            updateSliderUI: function() {
                const min = document.getElementById('lvl-min'), max = document.getElementById('lvl-max'), prog = document.getElementById('range-progress'), disp = document.getElementById('lvl-display');
                if(parseInt(min.value) > parseInt(max.value)) { min.value = max.value; }
                const p1 = (min.value / 130) * 100, p2 = (max.value / 130) * 100;
                prog.style.left = p1 + "%"; prog.style.width = (p2 - p1) + "%";
                disp.innerText = `${min.value} - ${max.value}`;
            },

            applyFilters: function() {
                const search = document.getElementById('filter-search').value.toLowerCase(), 
                      tier = document.getElementById('filter-tier').value, 
                      min = parseInt(document.getElementById('lvl-min').value), 
                      max = parseInt(document.getElementById('lvl-max').value), 
                      checked = Array.from(document.querySelectorAll('.stat-filter:checked')).map(c => c.value);

                const filtered = this.data.filter(i => {
                    const iLvl = i.requirements?.level || 0;
                    if(search && !i.name.toLowerCase().includes(search)) return false;
                    if(tier && i.tier !== tier) return false;
                    if(iLvl < min || iLvl > max) return false;
                    if(checked.length > 0 && (!i.identifications || !checked.every(s => i.identifications[s]))) return false;
                    return true;
                });

                document.getElementById('results-text').innerText = `${filtered.length.toLocaleString()} ASSETS VISIBLE`;
                document.getElementById('ingredient-grid').innerHTML = filtered.slice(0, 48).map(i => `
                    <div class="matte-card rounded-xl p-6 cursor-pointer tier-${i.tier.replace(' ', '')} group" onclick="app.showDetail('${i.internalName}')">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-bold text-sm tracking-tight text-white group-hover:text-blue-400 transition-colors uppercase">${i.name}</h3>
                            <span class="mono text-[9px] text-slate-500 bg-[#05070a] px-2 py-0.5 rounded">L${i.requirements?.level || 0}</span>
                        </div>
                        <div class="flex items-center justify-between mt-auto">
                            <span class="text-[9px] font-black uppercase tracking-widest text-slate-600">${i.tier}</span>
                            <div class="text-[9px] text-slate-500 font-bold flex items-center gap-1">
                                <i class="fas fa-location-crosshairs opacity-40"></i>
                                <span class="truncate max-w-[120px]">${i.communitySources ? i.communitySources[0].name : (i.dropMeta ? i.dropMeta.name : 'Unknown')}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            showDetail: function(name) {
                const i = this.data.find(x => x.internalName === name);
                document.getElementById('view-list').classList.add('hidden');
                document.getElementById('view-detail').classList.remove('hidden');
                window.scrollTo(0,0);
                
                let idHtml = Object.entries(i.identifications || {}).map(([k, v]) => {
                    const min = v.min !== undefined ? v.min : (v.minimum !== undefined ? v.minimum : v);
                    const max = v.max !== undefined ? v.max : (v.maximum !== undefined ? v.maximum : v);
                    const isNegative = max < 0;
                    return `
                        <div class="flex justify-between py-2 border-b border-[#1e2530]">
                            <span class="text-[10px] text-slate-500 uppercase font-bold tracking-wider">${k.replace(/([A-Z])/g, ' $1')}</span>
                            <span class="mono text-xs ${isNegative ? 'text-red-400' : 'text-blue-400'} font-bold">${min === max ? min : `${min} to ${max}`}</span>
                        </div>
                    `;
                }).join('');

                const renderSource = (s) => {
                    const type = s.type || 'Intel';
                    const name = s.name || 'Unknown Target';
                    const detail = s.details || {};
                    const loc = detail.location || s.location || '';
                    const desc = detail.description || s.description || '';
                    const sss = detail.screenshots || s.screenshots || '';
                    const coords = detail.coords || s.coords || (i.dropMeta ? {x: i.dropMeta.coordinates[0], z: i.dropMeta.coordinates[2]} : null);
                    const price = detail.price || s.price || null;

                    return `
                        <div class="matte-card p-6 rounded-xl mb-4 border-l-4 border-blue-600 bg-[#0a0d12]">
                            <div class="text-[9px] font-black text-slate-600 uppercase tracking-widest mb-1">${type}</div>
                            <div class="text-lg font-bold text-white uppercase mb-2 italic tracking-tight">${name}</div>
                            
                            ${desc ? `<p class="text-xs text-slate-400 mb-4 bg-black/40 p-3 italic rounded border border-white/5 leading-relaxed">"${desc}"</p>` : ''}
                            
                            ${loc ? `<div class="text-[10px] text-blue-400 uppercase font-bold mb-3 flex items-center gap-2"><i class="fas fa-map-location-dot"></i> ${loc}</div>` : ''}
                            
                            ${coords && coords.x ? `
                                <div class="bg-[#05070a] p-4 flex items-center justify-between border border-[#1e2530] rounded-lg mt-4">
                                    <span class="mono text-blue-400 font-bold text-xs">TP: ${coords.x}, ${coords.z}</span>
                                    <button onclick="app.copy('/tp ${coords.x} 100 ${coords.z}')" class="btn-imperial px-4 py-2 rounded">COPY COMMAND</button>
                                </div>
                            ` : ''}

                            ${sss ? `<a href="${sss}" target="_blank" class="mt-4 inline-block text-[9px] font-black text-slate-500 hover:text-white underline tracking-[0.2em] transition-all">VIEW SCREENSHOT &rsaquo;</a>` : ''}
                        </div>
                    `;
                };

                let sourcesHtml = '<div class="text-slate-600 italic text-xs py-10 text-center border border-dashed border-[#1e2530] rounded-xl">No field intel available for this asset.</div>';
                const allSources = [];
                if (i.communitySources) i.communitySources.forEach(s => allSources.push(s));

                if (allSources.length > 0) {
                    sourcesHtml = allSources.map(s => renderSource(s)).join('');
                } else if (i.dropMeta) {
                    sourcesHtml = renderSource({ type: i.dropMeta.type, name: i.dropMeta.name });
                }

                document.getElementById('detail-container').innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                        <div>
                            <div class="mb-8">
                                <span class="text-[10px] font-black uppercase tracking-[0.5em] text-blue-500 mb-2 block">Asset Classification</span>
                                <h1 class="text-5xl font-bold mb-4 tracking-tighter text-white uppercase italic">${i.name}</h1>
                                <div class="flex gap-4">
                                    <span class="bg-[#1e2530] text-slate-300 px-3 py-1 text-[9px] font-black uppercase tracking-widest rounded">${i.tier}</span>
                                    <span class="border border-[#1e2530] text-slate-500 px-3 py-1 text-[9px] font-black rounded mono">L${i.requirements?.level || 0}</span>
                                </div>
                            </div>
                            <div class="space-y-1">
                                <h4 class="text-[10px] font-black text-slate-600 uppercase tracking-widest mb-4">Identification Protocol</h4>
                                ${idHtml || '<div class="text-slate-700 italic text-sm">Static asset. No imbued properties.</div>'}
                            </div>
                        </div>
                        <div class="space-y-8">
                            <h4 class="text-[10px] font-black text-slate-600 uppercase tracking-[0.4em]">Field Intelligence</h4>
                            <div class="max-h-[700px] overflow-y-auto pr-4 space-y-4">
                                ${sourcesHtml}
                            </div>
                        </div>
                    </div>
                `;
            },

            showList: function() {
                document.getElementById('view-detail').classList.add('hidden');
                document.getElementById('view-list').classList.remove('hidden');
            },

            copy: function(txt) {
                const el = document.createElement('textarea'); el.value = txt; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
                const t = document.getElementById('toast'); t.classList.remove('opacity-0'); setTimeout(() => t.classList.add('opacity-0'), 2000);
            }
        };
        app.init();
    </script>
</body>
</html>
