<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imperial Sweat-Shop | Gated Knowledge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg-deep: #050505;
            --bg-matte: #121212;
            --bg-card: #181818;
            --border-matte: #252525;
            --crimson: #991b1b;
            --gold: #d4af37;
            --text-main: #d1d5db;
        }
        body { background-color: var(--bg-deep); color: var(--text-main); font-family: 'Inter', sans-serif; }
        .matte-container { background-color: var(--bg-matte); border: 1px solid var(--border-matte); }
        .matte-card { background-color: var(--bg-card); border: 1px solid var(--border-matte); }
        .matte-input { background-color: #000; border: 1px solid var(--border-matte); color: white; }
        .matte-input:focus { border-color: var(--gold); outline: none; }
        .range-slider-container { position: relative; height: 6px; background: #222; border-radius: 3px; margin: 20px 0; }
        .range-slider-progress { position: absolute; height: 100%; background: var(--gold); border-radius: 3px; }
        .range-input { position: absolute; width: 100%; top: -7px; background: none; pointer-events: none; -webkit-appearance: none; }
        .range-input::-webkit-slider-thumb { height: 18px; width: 18px; border-radius: 2px; background: var(--gold); cursor: pointer; pointer-events: auto; -webkit-appearance: none; border: 2px solid black; }
        .tier-Mythic { color: #ff00ff; }
        .tier-Fabled { color: #ff4444; }
        .tier-Legendary { color: #55ffff; }
        .tier-Rare { color: #ff55ff; }
        .tier-Unique { color: #ffff55; }
        .tier-Normal { color: #ffffff; }
        .imperial-header { text-transform: uppercase; letter-spacing: 0.2em; font-weight: 900; }
        .sweat-badge { background: var(--crimson); color: white; font-size: 9px; padding: 2px 6px; font-weight: bold; }
        .btn-imperial { background-color: var(--gold); color: black; font-weight: 800; text-transform: uppercase; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--border-matte); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="border-b border-[var(--border-matte)] bg-[var(--bg-matte)] h-20 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-full flex items-center justify-between">
            <div class="flex flex-col cursor-pointer" onclick="app.showList()">
                <div class="flex items-center gap-2">
                    <span class="imperial-header text-xl text-white">Imperial Sweat-Shop</span>
                    <span class="sweat-badge">GATEKEEPERS ONLY</span>
                </div>
                <span class="text-[10px] text-gray-500 tracking-[0.3em] font-mono">POWERED BY SBACIX â€” INTEL v2.1</span>
            </div>
            <div id="db-stats" class="text-[var(--gold)] font-mono text-xs hidden md:block uppercase tracking-widest">Loading...</div>
        </div>
    </nav>

    <main class="flex-grow max-w-7xl mx-auto w-full px-6 py-10">
        <div id="view-list" class="flex flex-col lg:flex-row gap-10">
            <aside class="w-full lg:w-72 space-y-8 flex-shrink-0">
                <div>
                    <label class="text-[10px] font-bold text-gray-500 uppercase mb-2 block tracking-tighter">Search Archives</label>
                    <input type="text" id="filter-search" placeholder="..." class="matte-input w-full p-3 rounded text-sm">
                </div>
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-[10px] font-bold text-gray-500 uppercase block tracking-tighter">Lvl Range</label>
                        <span class="text-xs text-[var(--gold)] font-mono" id="lvl-display">1 - 130</span>
                    </div>
                    <div class="range-slider-container">
                        <div id="range-progress" class="range-slider-progress"></div>
                        <input type="range" id="lvl-min" min="1" max="130" value="1" class="range-input">
                        <input type="range" id="lvl-max" min="1" max="130" value="130" class="range-input">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-500 uppercase mb-2 block tracking-tighter">Gated Properties</label>
                    <div class="matte-card rounded p-3">
                        <input type="text" id="stat-search" placeholder="Filter stats..." class="w-full bg-black/50 border-b border-[var(--border-matte)] mb-3 pb-1 text-[10px] outline-none text-[var(--gold)]">
                        <div id="filter-identifications" class="max-h-64 overflow-y-auto space-y-1 text-xs"></div>
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-500 uppercase mb-2 block tracking-tighter">Grade</label>
                    <select id="filter-tier" class="matte-input w-full p-3 rounded text-sm cursor-pointer">
                        <option value="">All</option>
                        <option value="Normal">Normal</option><option value="Unique">Unique</option>
                        <option value="Rare">Rare</option><option value="Legendary">Legendary</option>
                        <option value="Fabled">Fabled</option><option value="Mythic">Mythic</option>
                    </select>
                </div>
            </aside>

            <div class="flex-grow">
                <div id="results-text" class="text-[10px] font-bold text-gray-600 uppercase tracking-[0.3em] mb-8 text-center py-2 border-y border-white/5">Awaiting commands...</div>
                <div id="ingredient-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </div>
        </div>

        <div id="view-detail" class="hidden max-w-5xl mx-auto">
            <button onclick="app.showList()" class="mb-10 text-[10px] font-black tracking-[0.2em] text-gray-500 hover:text-[var(--gold)] transition-all uppercase">
                &lsaquo; RETURN TO ARCHIVE
            </button>
            <div id="detail-container"></div>
        </div>
    </main>

    <div id="toast" class="fixed bottom-10 right-10 bg-[var(--gold)] text-black px-8 py-4 font-black text-xs uppercase tracking-widest rounded shadow-2xl opacity-0 transition-all pointer-events-none z-[100]">COMMAND SUCCESS</div>

    <script>
        const app = {
            data: [],
            init: async function() {
                try {
                    const res = await fetch('public/data/ingredients.json');
                    this.data = await res.json();
                    document.getElementById('db-stats').innerText = `${this.data.length} ASSETS LOGGED`;
                    this.buildFilters();
                    this.setupListeners();
                    this.applyFilters();
                } catch(e) { document.getElementById('results-text').innerText = "ARCHIVE SYNC ERROR"; }
            },
            buildFilters: function() {
                const stats = new Set();
                this.data.forEach(i => i.identifications && Object.keys(i.identifications).forEach(s => stats.add(s)));
                document.getElementById('filter-identifications').innerHTML = Array.from(stats).sort().map(s => `
                    <label class="flex items-center gap-2 cursor-pointer hover:bg-white/5 p-1 rounded">
                        <input type="checkbox" value="${s}" class="stat-filter bg-black border-[var(--border-matte)] text-[var(--gold)]">
                        <span class="truncate text-gray-500 text-[10px] uppercase">${s.replace(/([A-Z])/g, ' $1')}</span>
                    </label>
                `).join('');
            },
            setupListeners: function() {
                const trigger = () => { this.updateSliderUI(); this.applyFilters(); };
                ['filter-search', 'filter-tier', 'lvl-min', 'lvl-max', 'filter-identifications'].forEach(id => {
                    document.getElementById(id).addEventListener('input', trigger);
                });
                document.getElementById('stat-search').addEventListener('input', (e) => {
                    const val = e.target.value.toLowerCase();
                    document.querySelectorAll('.stat-filter').forEach(r => {
                        const label = r.closest('label');
                        label.style.display = label.innerText.toLowerCase().includes(val) ? 'flex' : 'none';
                    });
                });
                this.updateSliderUI();
            },
            updateSliderUI: function() {
                const min = document.getElementById('lvl-min'), max = document.getElementById('lvl-max'), prog = document.getElementById('range-progress'), disp = document.getElementById('lvl-display');
                if(parseInt(min.value) > parseInt(max.value)) { min.value = max.value; }
                const p1 = (min.value / 130) * 100, p2 = (max.value / 130) * 100;
                prog.style.left = p1 + "%"; prog.style.width = (p2 - p1) + "%";
                disp.innerText = `${min.value} - ${max.value}`;
            },
            applyFilters: function() {
                const search = document.getElementById('filter-search').value.toLowerCase(), tier = document.getElementById('filter-tier').value, min = parseInt(document.getElementById('lvl-min').value), max = parseInt(document.getElementById('lvl-max').value), checked = Array.from(document.querySelectorAll('.stat-filter:checked')).map(c => c.value);
                const filtered = this.data.filter(i => {
                    const iLvl = i.requirements?.level || 0;
                    if(search && !i.name.toLowerCase().includes(search)) return false;
                    if(tier && i.tier !== tier) return false;
                    if(iLvl < min || iLvl > max) return false;
                    if(checked.length > 0 && (!i.identifications || !checked.every(s => i.identifications[s]))) return false;
                    return true;
                });
                document.getElementById('results-text').innerText = `${filtered.length} ASSETS VISIBLE`;
                document.getElementById('ingredient-grid').innerHTML = filtered.slice(0, 48).map(i => `
                    <div class="matte-card rounded p-6 cursor-pointer hover:border-[var(--gold)] transition-all group" onclick="app.showDetail('${i.internalName}')">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-black text-xs uppercase tracking-widest tier-${i.tier}">${i.name}</h3>
                            <span class="font-mono text-[9px] text-gray-600">L${i.requirements?.level || 0}</span>
                        </div>
                        <div class="text-[9px] text-gray-500 font-bold uppercase tracking-widest flex items-center gap-2">
                            <i class="ph ph-target"></i>
                            <span class="truncate">${i.communitySources ? i.communitySources[0].name : (i.dropMeta ? i.dropMeta.name : 'Redacted')}</span>
                        </div>
                    </div>
                `).join('');
            },
            showDetail: function(name) {
                const i = this.data.find(x => x.internalName === name);
                document.getElementById('view-list').classList.add('hidden');
                document.getElementById('view-detail').classList.remove('hidden');
                window.scrollTo(0,0);
                
                let idHtml = Object.entries(i.identifications || {}).map(([k, v]) => `
                    <div class="flex justify-between py-2 border-b border-white/5">
                        <span class="text-[10px] text-gray-600 uppercase font-black tracking-tight">${k.replace(/([A-Z])/g, ' $1')}</span>
                        <span class="font-mono text-xs ${v.maximum < 0 ? 'text-red-500' : 'text-[var(--gold)]'}">${v.minimum || v} to ${v.maximum || v}</span>
                    </div>
                `).join('');

                let sourcesHtml = '<div class="text-gray-600 italic text-xs mb-4">No community intel available.</div>';
                if (i.communitySources) {
                    sourcesHtml = i.communitySources.map(s => `
                        <div class="matte-card p-6 rounded mb-4 border-l-4 border-[var(--gold)]">
                            <div class="text-[9px] font-bold text-gray-600 uppercase mb-1">${s.type}</div>
                            <div class="text-lg font-black text-white italic uppercase mb-4">${s.name}</div>
                            ${s.details?.description ? `<p class="text-xs text-gray-400 mb-4 italic">"${s.details.description}"</p>` : ''}
                            ${s.details?.coords ? `
                                <div class="bg-black p-3 flex items-center justify-between border border-white/5">
                                    <span class="font-mono text-[var(--gold)] text-xs">${s.details.coords.x}, ${s.details.coords.y}, ${s.details.coords.z}</span>
                                    <button onclick="app.copy('/tp ${s.details.coords.x} ${s.details.coords.y} ${s.details.coords.z}')" class="btn-imperial px-4 py-1 text-[9px]">COPY /TP</button>
                                </div>
                            ` : ''}
                        </div>
                    `).join('');
                }

                document.getElementById('detail-container').innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                        <div>
                            <h1 class="text-5xl font-black mb-4 tracking-tighter text-white uppercase italic">${i.name}</h1>
                            <div class="flex gap-4 mb-12">
                                <span class="bg-[var(--gold)] text-black px-3 py-1 text-[9px] font-black uppercase tracking-widest">${i.tier}</span>
                                <span class="border border-white/10 text-gray-500 px-3 py-1 text-[9px] font-black">L${i.requirements?.level || 0}</span>
                            </div>
                            <div class="space-y-1">${idHtml || '<div class="text-gray-700 italic">No traits found.</div>'}</div>
                        </div>
                        <div class="space-y-8">
                            <h4 class="text-[10px] font-black text-gray-600 uppercase tracking-[0.3em]">Field Intelligence</h4>
                            ${sourcesHtml}
                            
                            <!-- CONTRIBUTOR TOOL -->
                            <div class="bg-[var(--bg-matte)] p-8 rounded border-t-2 border-[var(--gold)]">
                                <h4 class="text-[10px] font-black text-[var(--gold)] uppercase tracking-widest mb-4 flex items-center gap-2">
                                    <i class="ph ph-pencil"></i> Update Imperial Archives
                                </h4>
                                <div class="space-y-4">
                                    <input type="text" id="contrib-name" placeholder="Mob Name (e.g. Decaying Zombie)" class="matte-input w-full p-2 text-xs rounded">
                                    <div class="flex gap-2">
                                        <input type="text" id="contrib-x" placeholder="X" class="matte-input w-full p-2 text-xs rounded">
                                        <input type="text" id="contrib-z" placeholder="Z" class="matte-input w-full p-2 text-xs rounded">
                                    </div>
                                    <button onclick="app.generateIntel('${i.name}')" class="btn-imperial w-full py-3 text-xs tracking-widest">Generate Intel Patch</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },
            generateIntel: function(itemName) {
                const mob = document.getElementById('contrib-name').value;
                const x = document.getElementById('contrib-x').value;
                const z = document.getElementById('contrib-z').value;

                if(!mob || !x || !z) return alert("Archive error: Fields cannot be null.");

                const jsonBlock = `"${itemName}": [\n  {\n    "type": "specialdrop",\n    "name": "${mob}",\n    "details": {\n      "location": "Imperial Discovery",\n      "coords": { "x": "${x}", "z": "${z}" }\n    }\n  }\n],`;
                
                // Copy to clipboard
                this.copy(jsonBlock);
                
                // Alert user
                const go = confirm("Intel Block copied to clipboard!\n\nI will now open your GitHub Archive. Paste the block at the VERY END of the file (before the last bracket) and save.");
                if(go) {
                    window.open('https://github.com/sbacix/wynn-db/edit/main/data/community_coords.json', '_blank');
                }
            },
            showList: function() {
                document.getElementById('view-detail').classList.add('hidden');
                document.getElementById('view-list').classList.remove('hidden');
            },
            copy: function(txt) {
                const el = document.createElement('textarea'); el.value = txt; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
                const t = document.getElementById('toast'); t.classList.remove('opacity-0'); setTimeout(() => t.classList.add('opacity-0'), 2000);
            }
        };
        app.init();
    </script>
</body>
</html>
